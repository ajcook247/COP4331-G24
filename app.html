<!doctype html>
<html lang="en">
<head>
    <title>ContactMe</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link href="css/appstyles.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300&display=swap" rel="stylesheet">
</head>
<body>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
    <script src="js/app.js"></script>
    <script type="text/javascript">
		document.addEventListener('DOMContentLoaded', function() 
		{
			readCookie();
		}, false);
	</script>

    <div class="container-flex">
  		<div class="row-1">
  			<div class="col">
  				<div id= "titleBar" class="text-center" style="word-wrap:break-word">
  					<h1 id="title">ContactMe</h1>
  					<h1 id="userName"></h1>
  					<button id="logoutButton" type="button" onclick="doLogout()">Sign out</button>
  				</div>        
  			</div>
  		</div>
   
		<div class="row vh-100">
			<div class="col">
				<button type="button" id="addContactButton" data-toggle="modal" data-target="#createContactModal">Add Contact</button>
				<button type="button" id="editContactButton" data-toggle="modal" data-target="#updateContactModal">Update Contact</button>
				<button type="button" id="removeContactButton" data-toggle="modal" data-target="#deleteContactModal">Delete Contact</button>	
				<input type="text" id="contactsInput" class = "text-center" placeholder="Search for contacts...">
          
				<div class="modal fade" id="createContactModal" tabindex="-1" role="dialog" aria-labelledby="createContactModalCenterTitle" aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered" role="document">
						<div class="modal-content">
                
							<div class="modal-header" id="popupTitleContainer">
							  <h5 id = "popupTitle" class="modal-title" id="createContactModalLongTitle">Create A New Contact</h5>
							  <button type="button" id="closePopup" class="close" data-dismiss="modal" aria-label="Close">
							  <span aria-hidden="true">&times;</span>
							  </button>
							</div>
					  
							<div class="modal-body">
							  <span id="contactsResult"></span>
							  <span class="material-icons" style="font-size:36px;">
							  perm_identity
							  </span>
							  <input type="text" id="contactFirstName" placeholder="First Name"/><br />
							  <span class="material-icons" style="font-size:36px;">
							  perm_identity
							  </span>
							  <input type="text" id="contactLastName" placeholder="Last Name"/><br />
							  <span class="material-icons" style="font-size:36px;">email</span> 
							  <input type="text" id="contactEmail" placeholder="Email" name='userName' /> 
							  <br />
							  <span class="material-icons" style="font-size:36px;">phone</span>
							  <input type="text" id="contactPhone" placeholder="Phone Number" name='password'/>
							</div>
			
							<div class="modal-footer">
							  <button type="button" id="createContactButton" onclick="createContact()">Create</button>
							</div>
              
						</div>
					</div>
				</div>

				<div class="modal fade" id="updateContactModal" tabindex="-1" role="dialog" aria-labelledby="updateContactModalCenterTitle" aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered" role="document">
						<div class="modal-content">
                
							<div class="modal-header" id="popupTitleContainer">
							  <h5 id = "popupTitle" class="modal-title" id="updateContactModalLongTitle">Update Contact</h5>
							  <button type="button" id="closePopup" class="close" data-dismiss="modal" aria-label="Close">
							  <span aria-hidden="true">&times;</span>
							  </button>
							</div>
						  
							<div class="modal-body">
							  <span id="updateResult"></span>
							  <span class="material-icons" style="font-size:36px;">
							  perm_identity
							  </span>
							  <input type="text" id="updateFirstName" placeholder="First Name"/><br />
							  <span class="material-icons" style="font-size:36px;">
							  perm_identity
							  </span>
							  <input type="text" id="updateLastName" placeholder="Last Name"/><br />
							  <span class="material-icons" style="font-size:36px;">email</span> 
							  <input type="text" id="updateEmail" placeholder="Email" name='userName' /> 
							  <br />
							  <span class="material-icons" style="font-size:36px;">phone</span>
							  <input type="text" id="updatePhone" placeholder="Phone Number" name='password'/>
							</div>
    
							<div class="modal-footer">
							  <button type="button" id="updateContactButton" onclick="updateContact()">Update</button>
							</div>
						</div>
					</div>
				</div>

				<div class="modal fade" id="deleteContactModal" tabindex="-1" role="dialog" aria-labelledby="deleteContactModalCenterTitle" aria-hidden="true">
					<div class="modal-dialog modal-dialog-centered" role="document">
						<div class="modal-content">
                
							<div class="modal-header" id="popupTitleContainer">
							  <h5 id = "popupTitle" class="modal-title" id="deleteContactModalLongTitle">Delete Contact</h5>
							  <button type="button" id="closePopup" class="close" data-dismiss="modal" aria-label="Close">
							  <span aria-hidden="true">&times;</span>
							  </button>
							</div>
						  
							<div class="modal-body">
							  <span id="deleteResult"></span>
							  <span class="material-icons" style="font-size:36px;">
							  perm_identity
							  </span>
							  <input type="text" id="deleteFirstName" placeholder="First Name"/><br />
							  <span class="material-icons" style="font-size:36px;">
							  perm_identity
							  </span>
							  <input type="text" id="deleteLastName" placeholder="Last Name"/><br />
							  <span class="material-icons" style="font-size:36px;">email</span> 
							  <input type="text" id="deleteEmail" placeholder="Email" name='userName' /> 
							  <br />
							  <span class="material-icons" style="font-size:36px;">phone</span>
							  <input type="text" id="deletePhone" placeholder="Phone Number" name='password'/>
							</div>
    
							<div class="modal-footer">
								<button type="button" id="deleteContactButton" onclick="deleteContact()">Delete</button>
							</div> 
						</div>
					</div>
				</div>  
				
				<div class="card card-body">
				
					<!-- Form Wrapper & Button -->
					<div class="form-wrapper hidden">
						<select class="form-control" id="test-name">
							<option>----------</option>
							<option>Flash Point</option>
							<option>Water</option>
							<option>Distillation</option>
						</select>
						<input class="form-control" type="text" id="test-result">
						<button class="btn btn-sm btn-info" id="create-test">Add</button>
					</div>
				
					<!-- Data Table -->
					<table class="table">
						<thead>
							<tr>
								<th scope="col">First Name</th>
								<th scope="col">Last Name</th>
								<th scope="col">Email</th>
								<th scope="col">Phone</th>
                <th scope="col">Actions</th>                    
							</tr>
						</thead>
						<tbody id="tests-table">
							
						</tbody>
					</table>
				
				</div>
			</div>
		</div>
	</div>
    
<script>

  var newId = 4;
  var newTest = {'name':null, 'id':newId, 'result':null};
  
  $('#add-test').on('click', function()
  {
  	$('.form-wrapper').removeClass('hidden')
  })
  
  
  $('#test-result').on('keyup', function()
  {
  	newTest.result = $(this).val()
  	console.log(newTest)
  
  })
  
  $('#test-name').on('change', function()
  {
  	newTest.name = $(this).val()
  	console.log(newTest)
  })
  
  $('#create-test').on('click', function()
  {
    if(newTest.name == null)
    {
  		alert('No test selected!')
    }
    else
    {
  		addRow(newTest)
  		$('#test-name').val('')
  		$('#test-result').val('')
  		$('.form-wrapper').addClass('hidden')
  	}
  })
  
  
  var tests = [
  	{'name':'Distillation 50%', 'id':'1', 'result':"43"},
      {'name':'Flash Point', 'id':'2', 'result':"61"},
      {'name':'Water By Karl Fischer', 'id':'3', 'result':"24"},
  ]
  
  
  for (var i in tests)
  {
  	addRow(tests[i])
  }
  
  function addRow(obj)
  {
  	var row = `<tr scope="row" class="test-row-${obj.id}">
        			   <td id="name-${obj.id}" data-testid="${obj.id}">${obj.name}</td>
                 <td id="result-${obj.id}" data-testid="${obj.id}">${obj.result}</td>
                 <td id="email-${obj.id}" data-testid="${obj.id}">${obj.result}</td>
                 <td id="phone-${obj.id}" data-testid="${obj.id}">${obj.result}</td>
                 <td>
                   <button class="btn btn-sm btn-info" disabled data-testid="${obj.id}"  id="save-${obj.id}">Update</button>   
	          	     <button class="btn btn-sm btn-danger" data-testid=${obj.id} id="delete-${obj.id}">Delete</button>	
                 </td>
      		     </tr>`
  	$('#tests-table').append(row)
  
  	$(`#delete-${obj.id}`).on('click', deleteTest)
  	$(`#save-${obj.id}`).on('click', saveUpdate)
    $(`#name-${obj.id}`).on('click', editResult)
  	$(`#result-${obj.id}`).on('click', editResult)
    $(`#email-${obj.id}`).on('click', editResult)
    $(`#phone-${obj.id}`).on('click', editResult)
  	
  }
  
  function editResult()
  {
  	var testid = $(this).data('testid')
  	var value = $(this).html()
  
  	$(this).unbind()
  	$(this).html(`<input class="result form-control" data-testid="${testid}" type="text" value="${value}">`)
  
    $(`.result`).on('keyup', function()
    {
  		var testid = $(this).data('testid')
  		var saveBtn = $(`#save-${testid}`)
  		saveBtn.prop('disabled', false)
  
  	})
  }
  
  function saveUpdate()
  { 
  	var testid = $(this).data('testid')
  	var saveBtn = $(`#save-${testid}`)
  	var row = $(`.test-row-${testid}`)
  
  	saveBtn.prop('disabled', true)
  }
  
  
  function deleteTest()
  {
  	var testid = $(this).data('testid')
    var row = $(`.test-row-${testid}`)
  	row.remove()
  }
</script>
</body>
</html>